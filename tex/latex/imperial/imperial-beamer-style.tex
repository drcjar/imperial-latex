% Copyright 2007 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/licenses/LICENSE for more details.

% Modified by James Keirstead for Imperial College style files
% Load necessary packages 
% -----------------------

% Common packages
\usepackage{imperial-common}
\usepackage{fancyhdr}
\usepackage{listings}

% Basic style configuration
% -----------------------

% Set the logo
\logo{\includegraphics[width=1in]{\imperiallogo}}

% Use a nicer font
\setsansfont[Mapping=tex-text]{Myriad Pro}

% Set default colours
\definecolor{codebg}{rgb}{0.3,0.3,0.3}
\definecolor{headings}{named}{ImperialBlue}

% Custom commands and environments
% -------------------
\newcommand{\eventdetails}{}

% Define insert graphics with copyright info
\newbox\mytempbox
\newdimen\mytempdimen
\newcommand\includegraphicscopyright[3][]{%
  \leavevmode\vbox{%
  \vskip3pt\raggedright\setbox\mytempbox=\hbox{\includegraphics[#1]{#2}}%
   \mytempdimen=\wd\mytempbox\box\mytempbox\par\vskip1pt%
  {\fontsize{5}{6}\selectfont{\color{black!75}{\vbox{\hsize=\mytempdimen#3}}}}%
\vskip3pt%
}}

% Listings set up
% --------------------
% The default listing stylings and language
\lstset{language=Java}
\mode<all>{%
  \lstset{%
  basicstyle=\ttfamily,
  commentstyle=\slshape\color{green!50!black},
  keywordstyle=\bfseries\color{headings!50!black},
  backgroundcolor=\color{codebg!10},
  identifierstyle=\color{headings},
  stringstyle=\color{orange},
  escapechar=\#,
  emphstyle=\color{red}}
}

% Adjust the font size for slides
\mode<presentation>{%
  \lstset{%
  basicstyle=\footnotesize\ttfamily}
}

% This doesn't seem to work properly in slides
\mode<article>{%
  \lstnewenvironment{rcode}{%
    \lstset{language=R}}{}
}
\mode<presentation>{%
  \lstnewenvironment{rcode}{%
    \lstset{language=R}}{}
}

% Beamer set up
% ------------------------
% Set basic beamer theme
\usecolortheme{rose}
\useinnertheme{circles}
\usefonttheme[only large]{structurebold}

\setbeamercolor{sidebar right}{bg=black!15}
\setbeamercolor{structure}{fg=headings}
\setbeamercolor{author}{parent=structure}

\setbeamerfont{title}{series=\normalfont,size=\LARGE}
\setbeamerfont*{item}{series=}
\setbeamerfont{frametitle}{size=, series=\bfseries}
\setbeamerfont{framesubtitle}{series=\normalfont}
\setbeamerfont{block title}{size=\small}
\setbeamerfont{subtitle}{size=\normalsize,series=\normalfont}

\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{bibliography item}[book]

% From lecture style
\usecolortheme{rose,sidebartab}

% Templates
\setbeamertemplate{title page}
{
  \vbox{}
  \vskip1em
  {\usebeamercolor[fg]{title}\usebeamerfont{title}\inserttitle\par}%
  \ifx\insertsubtitle\@empty%
  \else%
    \vskip0.25em%
    {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
  \fi%     
  \vskip1em\par
  {\small\insertauthor\par
  \insertinstitute\par
  \vskip10em\par
  \eventdetails\par
  \insertdate\par}
}

% Beamer article settings
% -------------------------

% Slide numbering tricks.  See the lectures project for other slide framing examples.
 
% Definition for lined
\defbeamertemplate<article>{frame begin}{lined}{\par\noindent\rule{\textwidth}{1pt}\par}
\defbeamertemplate<article>{frame end}{lined}{\par\noindent\rule{\textwidth}{1pt}\par}
 
% Definition for margin
\defbeamertemplate<article>{frame begin}{margins}{\sffamily}
\defbeamertemplate<article>{frame end}{margins}{\marginpar{\scriptsize\hbox to 1cm{\sffamily \hfill\strut Slide~\insertframenumber}\hrule height .2pt}}

\mode<article>{%
  % Select the style
  \setbeamertemplate{frame begin}[margins]
  \setbeamertemplate{frame end}[margins]
  % Bump labels out to margin 
  \setlength{\marginparwidth}{1cm}
  \setlength{\marginparsep}{4.5cm}
}

\newlength{\logowidth}
\setlength{\logowidth}{2cm}

\mode<article>{%

% Geometry settings
\usepackage[left=1.5cm,right=6cm,top=1.5cm,bottom=3cm]{geometry}

% Tweak frame title (no separate line for subtitle)
\setbeamertemplate{frametitle}{\paragraph*{\insertframetitle\
    \ \small\insertframesubtitle}\ \par
}


% Internal commands
\makeatletter

% Configure section style
\let\origstartsection=\@startsection
\def\@startsection#1#2#3#4#5#6{%
  \origstartsection{#1}{#2}{#3}{#4}{#5}{#6\normalfont\sffamily\color{headings}\selectfont}}

% Configure list style: not quite sure what the effect of this is
%\def\@listI{\leftmargin\leftmargini
%  \parsep 0pt
%  \topsep 5\p@   \@plus3\p@ \@minus5\p@
%  \itemsep0pt}
%\let\@listi=\@listI

\makeatother


% First page formatting
   \fancypagestyle{plain}{%
   \fancyhead{}%
   \fancyfoot{}%
   \renewcommand{\headrulewidth}{0pt}%
   \renewcommand{\footrulewidth}{0pt}%
%   \lhead{\hbox to2.1cm{\hss\includegraphics[width=2cm]{\mylogo}\hss}}%
   \lhead{\includegraphics[width=\logowidth]{\imperiallogo}}%
   %% git revision control footer 
%   \rfoot{\textcolor{black!30}{\texttt{\scriptsize \VCRevision\ on \VCDateISO}}}} 
}   
% Subsequent pages
   \pagestyle{fancy}%
   \fancyhead{}%
   \fancyfoot{}%
%   \lhead{{\ifthenelse{\equal{\mycoursenum}{-1}}{}{\mycoursenum}\ \mycourse}}%
   \rhead{{\thepage}}%
   \renewcommand{\headrulewidth}{0pt}
   %% git revision control footer 
%   \rfoot{\textcolor{black!30}{\texttt{\scriptsize \VCRevision\ on \VCDateISO}}}%
 }

\mode<all>
